<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JunglerOS - Tactical Draft Engine</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom Styles -->
    <style>
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #f3f4f6;
            overflow: hidden; /* Prevent body scroll */
        }
        /* Hide Scrollbar but allow scrolling */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        .animate-scaleUp { animation: scaleUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .dragging-over {
            background-color: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- ICONS ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Icons = {
            Swords: (p) => <Icon {...p} path={<><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="m13 19 6-6"/><path d="M16 16l4 4"/><path d="M19 21l2-2"/></>} />,
            Target: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            Zap: (p) => <Icon {...p} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>} />,
            Skull: (p) => <Icon {...p} path={<><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></>} />,
            Edit3: (p) => <Icon {...p} path={<><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></>} />,
            Trash2: (p) => <Icon {...p} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            MessageSquare: (p) => <Icon {...p} path={<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>} />,
            Search: (p) => <Icon {...p} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />,
            Crown: (p) => <Icon {...p} path={<path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/>} />,
            RotateCcw: (p) => <Icon {...p} path={<><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></>} />,
            Chart: (p) => <Icon {...p} path={<><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></>} />,
            Info: (p) => <Icon {...p} path={<><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></>} />,
            Download: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} />,
            Upload: (p) => <Icon {...p} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />,
            Database: (p) => <Icon {...p} path={<><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></>} />,
            Pencil: (p) => <Icon {...p} path={<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>} />,
            Plus: (p) => <Icon {...p} path={<><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></>} />,
            Image: (p) => <Icon {...p} path={<><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></>} />
        };

        // --- DATA ---
        const HERO_ROLES = { ROAM: 'Roaming', GOLD: 'Gold Lane', EXP: 'Exp Lane', MID: 'Mid Lane', JUNGLE: 'Jungling' };
        const RAW_HERO_DATA = {
          [HERO_ROLES.ROAM]: ["Saber", "Tigreal", "Akai", "Franco", "Rafaela", "Minotaur", "Natalia", "Chou", "Johnson", "Estes", "Gatotkaca", "Grock", "Hylos", "Jawhead", "Angela", "Kaja", "Selena", "Belerick", "Minsitthar", "Khufra", "Carmilla", "Atlas", "Khaleed", "Mathilda", "Gloo", "Edith", "Floryn", "Chip", "Kalea", "Lolita", "Hilda", "Diggie"],
          [HERO_ROLES.GOLD]: ["Miya", "Bruno", "Clint", "Layla", "Moskov", "Karrie", "Irithel", "Lesley", "Hanabi", "Claude", "Kimmy", "Harith", "Granger", "Wanwan", "Popol and Kupa", "Brody", "Beatrix", "Natan", "Melissa", "Ixia"],
          [HERO_ROLES.EXP]: ["Balmond", "Alice", "Bane", "Zilong", "Freya", "Chou", "Sun", "Alpha", "Ruby", "Lapu-Lapu", "Gatotkaca", "Argus", "Jawhead", "Uranus", "Aldous", "Thamuz", "Minsitthar", "Badang", "Guinevere", "Esmeralda", "Terizla", "X.Borg", "Dyrroth", "Masha", "Silvanna", "Yu Zhong", "Benedetta", "Khaleed", "Paquito", "Gloo", "Phoveus", "Edith", "Yin", "Arlott", "Cici", "Lukas", "Hilda"],
          [HERO_ROLES.MID]: ["Nana", "Eudora", "Gord", "Kagura", "Cyclops", "Aurora", "Odette", "Zhask", "Pharsa", "Valir", "Chang'e", "Selena", "Vale", "Lunox", "Kimmy", "Harith", "Kadita", "Faramis", "Lylia", "Cecilion", "Luo Yi", "Valentina", "Xavier", "Novaria", "Zhuxin", "Zetian", "Vexana", "Yve"],
          [HERO_ROLES.JUNGLE]: ["Balmond", "Saber", "Alice", "Alucard", "Karina", "Bane", "Fanny", "Hayabusa", "Freya", "Natalia", "Sun", "Alpha", "Yi Sun-Shin", "Roger", "Harley", "Lancelot", "Helcurt", "Gusion", "Martis", "Leomord", "Hanzo", "Ling", "Dyrroth", "Baxia", "Popol and Kupa", "Barats", "Aulus", "Aamon", "Yin", "Julian", "Fredrinn", "Joy", "Nolan", "Suyou", "Lukas"]
        };
        const TIERS = ['S', 'A', 'B', 'C', 'D'];
        const TIER_WEIGHTS = { S: 10, A: 7, B: 5, C: 3, D: 1 };
        const TIER_COLORS = { S: 'bg-red-500', A: 'bg-orange-500', B: 'bg-yellow-500', C: 'bg-blue-500', D: 'bg-gray-500' };

        const ALL_HEROES = [];
        Object.entries(RAW_HERO_DATA).forEach(([role, names]) => {
            names.forEach(name => {
                if (!ALL_HEROES.find(h => h.name === name)) ALL_HEROES.push({ id: name, name, role });
            });
        });
        ALL_HEROES.push({ id: 'Unpicked', name: 'Unpicked', role: 'Neutral' });

        // --- UTILS ---
        const getHeroSlug = (name) => {
            if (name === 'Unpicked') return 'unpicked';
            if (name === 'Yi Sun-Shin') return 'yi_sun-shin';
            if (name === 'Popol and Kupa') return 'popol_and_kupa';
            if (name === 'Chang\'e') return 'change';
            return name.toLowerCase().replace(/[^a-z0-9]/g, '');
        };

        const getHeroImage = (name, customImages = {}) => {
            if (name === 'Unpicked') return null;
            if (customImages && customImages[name]) return customImages[name];
            const slug = getHeroSlug(name);
            return `https://raw.githubusercontent.com/akhmadfian/mobile-legends-hero-list/master/assets/images/heroes/${slug}.jpg`;
        };

        const compressImage = (file, callback) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 100; canvas.height = 100;
                    ctx.drawImage(img, 0, 0, 100, 100);
                    callback(canvas.toDataURL('image/jpeg', 0.7));
                };
            };
        };

        // --- COMPONENTS ---

        const GlobalTooltip = ({ content, x, y, visible }) => {
            if (!visible || !content) return null;
            const style = {
                left: Math.min(window.innerWidth - 200, x) + 'px',
                top: Math.min(window.innerHeight - 100, y) + 'px',
                position: 'fixed', zIndex: 9999, pointerEvents: 'none'
            };
            return (
                <div style={style} className="bg-slate-900 text-white text-xs px-3 py-2 rounded-md border border-white/20 shadow-2xl flex flex-col items-center min-w-[120px] animate-fadeIn">
                    <span className="font-bold text-cyan-400 mb-1 text-sm">{content.name}</span>
                    <span className="text-[10px] text-gray-400 uppercase tracking-wider mb-1">{content.role}</span>
                    {content.quickNote && <div className="mt-1 pt-1 border-t border-white/10 text-yellow-300 italic max-w-[150px] whitespace-normal text-center leading-tight">"{content.quickNote}"</div>}
                </div>
            );
        };

        const RadarChart = ({ heroes, onSelect, currentHero }) => {
            const size = 240; const center = size / 2; const radius = 75;
            const displayHeroes = [...heroes];
            while(displayHeroes.length < 6) displayHeroes.push({ name: `Alt ${displayHeroes.length + 1}`, score: 0, isPlaceholder: true });
            const top6 = displayHeroes.slice(0, 6);
            const maxScore = Math.max(...top6.map(h => h.score)) || 1;
            const getPoints = (dataVals, r) => dataVals.map((h, i) => {
                const val = h.isPlaceholder ? 30 : (h.score / maxScore) * 100;
                const angle = (Math.PI * 2 * i) / 6 - Math.PI / 2;
                const len = (val / 100) * r;
                return `${center + len * Math.cos(angle)},${center + len * Math.sin(angle)}`;
            }).join(" ");

            return (
                <div className="relative flex flex-col items-center">
                    <svg width={size} height={size} className="overflow-visible">
                        {[100, 75, 50, 25].map((lvl, i) => (
                            <polygon key={lvl} points={getPoints(Array(6).fill({score: maxScore * (lvl/100)}), radius)} fill="none" stroke={i === 0 ? "#22d3ee" : "rgba(255,255,255,0.1)"} strokeWidth="1" />
                        ))}
                        {top6.map((_, i) => {
                            const angle = (Math.PI * 2 * i) / 6 - Math.PI / 2;
                            return <line key={i} x1={center} y1={center} x2={center + radius * Math.cos(angle)} y2={center + radius * Math.sin(angle)} stroke="rgba(255,255,255,0.1)" />;
                        })}
                        <polygon points={getPoints(top6, radius)} fill="rgba(34, 211, 238, 0.2)" stroke="#22d3ee" strokeWidth="2" />
                        {top6.map((hero, i) => {
                            const angle = (Math.PI * 2 * i) / 6 - Math.PI / 2;
                            const x = center + (radius + 30) * Math.cos(angle); const y = center + (radius + 15) * Math.sin(angle);
                            const isSelected = currentHero && currentHero.name === hero.name;
                            return (
                                <g key={i} onClick={() => !hero.isPlaceholder && onSelect(hero)} className={hero.isPlaceholder ? '' : 'cursor-pointer group'}>
                                    <circle cx={x} cy={y} r="20" fill="transparent" />
                                    <text x={x} y={y} fill={isSelected ? "#22d3ee" : (hero.isPlaceholder ? "#475569" : "#94a3b8")} fontSize={isSelected ? "11" : "9"} textAnchor="middle" dominantBaseline="middle" fontWeight="bold" className="transition-all duration-200 group-hover:fill-white group-hover:text-xs">{hero.name}</text>
                                    {!hero.isPlaceholder && <text x={x} y={y+12} fill={isSelected ? "#22d3ee" : "#64748b"} fontSize="8" textAnchor="middle" dominantBaseline="middle">{hero.score} pts</text>}
                                </g>
                            );
                        })}
                    </svg>
                    <div className="text-cyan-400 text-[10px] uppercase tracking-widest mt-2">Alternative Picks Matrix</div>
                </div>
            );
        };

        const HeroAvatar = ({ name, role, size = 'md', className = '', showTooltip = true, quickNote = null, onEditNote = null, customImages = {}, setTooltip }) => {
            const isUnpicked = name === 'Unpicked';
            const initials = isUnpicked ? '?' : name.substring(0, 2);
            const sizeClasses = { sm: 'w-10 h-10 text-xs', md: 'w-14 h-14 text-sm', lg: 'w-20 h-20 text-base', xl: 'w-24 h-24 text-xl' };
            const [imgError, setImgError] = useState(false);
            
            useEffect(() => { setImgError(false); }, [name]);

            const handleMouseEnter = (e) => {
                if (showTooltip && !isUnpicked && setTooltip) {
                    const rect = e.target.getBoundingClientRect();
                    setTooltip({
                        visible: true,
                        x: rect.left + rect.width / 2,
                        y: rect.top - 10,
                        content: { name, role, quickNote }
                    });
                }
            };

            const handleMouseLeave = () => { if (setTooltip) setTooltip(prev => ({ ...prev, visible: false })); };

            return (
                <div className={`relative group flex flex-col items-center ${className}`} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave}>
                    <div className={`${sizeClasses[size]} rounded-xl shadow-lg flex items-center justify-center font-bold text-white overflow-hidden bg-slate-800 border border-white/10 relative transition-all duration-200 group-hover:scale-110 group-hover:shadow-cyan-500/20 group-hover:border-white/30`}>
                        {!isUnpicked && !imgError ? (<img src={getHeroImage(name, customImages)} alt={name} className="w-full h-full object-cover" onError={() => setImgError(true)} />) : (<span className="z-10">{initials}</span>)}
                        {(isUnpicked || imgError) && <div className={`absolute inset-0 bg-gradient-to-br from-slate-700 to-slate-800`}></div>}
                        <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" />
                    </div>
                    {onEditNote && !isUnpicked && (<button onClick={(e) => { e.stopPropagation(); onEditNote(); }} className="absolute -top-2 -right-2 z-20 bg-yellow-500 text-black p-1 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-yellow-400" title="Add Quick Tip"><Icons.Pencil size={10} /></button>)}
                </div>
            );
        };

        // --- MAIN APP ---

        function App() {
            const [view, setView] = useState('draft'); 
            const [enemySlots, setEnemySlots] = useState([null, null, null, null, null]);
            const [selectedRoleFilter, setSelectedRoleFilter] = useState('All');
            
            // Editor State
            const [editorJungler, setEditorJungler] = useState(null);
            const [editorSearch, setEditorSearch] = useState('');
            const [activeQuickRankTier, setActiveQuickRankTier] = useState(null);
            const [editingCommentHero, setEditingCommentHero] = useState(null);
            const [commentText, setCommentText] = useState('');
            const [editingQuickNoteHero, setEditingQuickNoteHero] = useState(null);
            const [quickNoteText, setQuickNoteText] = useState('');
            const [editorRoleFilter, setEditorRoleFilter] = useState('All');
            const [junglerList, setJunglerList] = useState(RAW_HERO_DATA[HERO_ROLES.JUNGLE]);
            const [isAddingJungler, setIsAddingJungler] = useState(false);
            const [newJunglerName, setNewJunglerName] = useState('');

            // Asset State
            const [customImages, setCustomImages] = useState({}); 
            const [assetsSearch, setAssetsSearch] = useState('');

            const [isDragging, setIsDragging] = useState(false);
            const [draggingSource, setDraggingSource] = useState(null);
            const [matchupData, setMatchupData] = useState({});
            const fileInputRef = useRef(null);
            const [viewedHero, setViewedHero] = useState(null);
            const [tooltipState, setTooltipState] = useState({ visible: false, x: 0, y: 0, content: null });

            useEffect(() => {
                const savedData = localStorage.getItem('moba_matchup_data_v1');
                if (savedData) setMatchupData(JSON.parse(savedData));
                const savedList = localStorage.getItem('moba_jungler_list_v1');
                if (savedList) setJunglerList(JSON.parse(savedList));
                const savedImages = localStorage.getItem('moba_custom_images_v1');
                if (savedImages) setCustomImages(JSON.parse(savedImages));
            }, []);

            const saveToStorage = (newData) => { setMatchupData(newData); localStorage.setItem('moba_matchup_data_v1', JSON.stringify(newData)); };
            const saveJunglerList = (newList) => { setJunglerList(newList); localStorage.setItem('moba_jungler_list_v1', JSON.stringify(newList)); };
            const saveCustomImages = (newImages) => { setCustomImages(newImages); localStorage.setItem('moba_custom_images_v1', JSON.stringify(newImages)); };

            const handleAddJungler = () => {
                if (newJunglerName.trim() && !junglerList.includes(newJunglerName.trim())) {
                    saveJunglerList([...junglerList, newJunglerName.trim()]);
                    setEditorJungler(newJunglerName.trim());
                    setNewJunglerName(''); setIsAddingJungler(false);
                }
            };

            const handleDeleteJungler = () => {
                if (!editorJungler) return;
                if (confirm(`Delete ${editorJungler} from roster?`)) {
                    const newList = junglerList.filter(j => j !== editorJungler);
                    saveJunglerList(newList);
                    const newMatchupData = { ...matchupData };
                    delete newMatchupData[editorJungler];
                    saveToStorage(newMatchupData);
                    setEditorJungler(null);
                }
            };

            const handleAssetUpload = (e, heroName) => {
                const file = e.target.files[0];
                if (file) {
                    compressImage(file, (base64) => {
                        const newImages = { ...customImages, [heroName]: base64 };
                        saveCustomImages(newImages);
                    });
                }
            };

            const sortedJunglers = useMemo(() => {
                const filledSlots = enemySlots.filter(s => s && s.name !== 'Unpicked');
                if (filledSlots.length === 0) return [];
                const scores = junglerList.map(junglerName => {
                    let totalScore = 0; let matchupsKnown = 0;
                    const junglerMatchups = matchupData[junglerName] || {};
                    filledSlots.forEach(enemy => {
                        const match = junglerMatchups[enemy.name];
                        if (match) { totalScore += TIER_WEIGHTS[match.tier]; matchupsKnown++; }
                        else { totalScore += TIER_WEIGHTS['B']; }
                    });
                    return { name: junglerName, score: totalScore, matchupsKnown, data: junglerMatchups };
                });
                scores.sort((a, b) => b.score - a.score);
                return scores;
            }, [enemySlots, matchupData, junglerList]);

            const priorityPick = sortedJunglers.length > 0 ? sortedJunglers[0] : null;
            const currentDisplayHero = viewedHero || priorityPick;
            useEffect(() => { setViewedHero(null); }, [enemySlots]);

            // Drag Handlers
            const handleDragStart = (e, hero, source, index = null) => {
                e.dataTransfer.setData('hero', JSON.stringify(hero));
                e.dataTransfer.setData('source', source);
                if (index !== null) e.dataTransfer.setData('slotIndex', index);
                setIsDragging(true); setDraggingSource(source);
            };
            const handleDragEnd = () => { setIsDragging(false); setDraggingSource(null); };
            
            const handleDropOnSlot = (e, index) => {
                e.preventDefault();
                const heroData = e.dataTransfer.getData('hero');
                const source = e.dataTransfer.getData('source');
                if (source === 'slot') {
                    const oldIndex = parseInt(e.dataTransfer.getData('slotIndex'));
                    const newSlots = [...enemySlots];
                    const movedHero = newSlots[oldIndex];
                    newSlots[oldIndex] = null; newSlots[index] = movedHero;
                    setEnemySlots(newSlots);
                } else if (source.includes('pool')) {
                    if (!heroData) return;
                    const newSlots = [...enemySlots];
                    newSlots[index] = JSON.parse(heroData);
                    setEnemySlots(newSlots);
                }
                handleDragEnd();
            };
            const handleDropOnDraftPool = (e) => {
                e.preventDefault();
                if (e.dataTransfer.getData('source') === 'slot') {
                    const index = parseInt(e.dataTransfer.getData('slotIndex'));
                    const newSlots = [...enemySlots];
                    newSlots[index] = null;
                    setEnemySlots(newSlots);
                }
                handleDragEnd();
            };
            const handleDropOnUnranked = (e) => {
                e.preventDefault();
                const source = e.dataTransfer.getData('source');
                const heroData = e.dataTransfer.getData('hero');
                if (source === 'tier_item' && editorJungler && heroData) {
                    const hero = JSON.parse(heroData);
                    const d = { ...matchupData };
                    if (d[editorJungler]) { delete d[editorJungler][hero.name]; saveToStorage(d); }
                }
                handleDragEnd();
            };
            const handleDropOnTier = (e, tier) => {
                e.preventDefault();
                if (!editorJungler) return;
                const heroData = e.dataTransfer.getData('hero');
                if (!heroData) return;
                const hero = JSON.parse(heroData);
                const d = { ...matchupData };
                if (!d[editorJungler]) d[editorJungler] = {};
                d[editorJungler][hero.name] = { ...(d[editorJungler][hero.name] || {}), tier };
                saveToStorage(d);
                handleDragEnd();
            };

            const updateMatchup = (junglerName, targetName, tier) => {
                const d = { ...matchupData };
                if (!d[junglerName]) d[junglerName] = {};
                d[junglerName][targetName] = { ...(d[junglerName][targetName] || {}), tier };
                saveToStorage(d);
            };

            // --- PERFECT BACKUP LOGIC (BLOB) ---
            const handleExport = () => {
                const exportData = { version: "1.3", timestamp: new Date().toISOString(), matchupData, junglerList, customImages };
                const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: "application/json"});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `jungleros_full_backup_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);
            };

            const handleImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try { 
                        const imported = JSON.parse(ev.target.result);
                        if (!imported.matchupData && !imported.junglerList) throw new Error("Invalid file");
                        if (imported.junglerList) saveJunglerList(imported.junglerList);
                        if (imported.matchupData) saveToStorage(imported.matchupData);
                        if (imported.customImages) saveCustomImages(imported.customImages);
                        alert(`Restored: ${Object.keys(imported.customImages || {}).length} Assets, ${imported.junglerList?.length || 0} Junglers`); 
                    } catch { alert("Error parsing file."); }
                };
                reader.readAsText(file);
                e.target.value = null;
            };

            // --- STATS ---
            const stats = useMemo(() => {
                const junglerCount = junglerList.length;
                const imageCount = Object.keys(customImages).length;
                let matchupCount = 0;
                Object.values(matchupData).forEach(d => matchupCount += Object.keys(d).length);
                return { junglerCount, imageCount, matchupCount };
            }, [junglerList, customImages, matchupData]);

            const renderHeroPool = (dragSource, filterRole, clickHandler = null) => {
                let heroes = ALL_HEROES.filter(h => h.name !== 'Unpicked');
                if (filterRole !== 'All') heroes = heroes.filter(h => h.role === filterRole);
                if (view === 'editor' && editorJungler && dragSource === 'unranked_pool') {
                    const ranked = matchupData[editorJungler] || {};
                    heroes = heroes.filter(h => !ranked[h.name]);
                }
                if (editorSearch) heroes = heroes.filter(h => h.name.toLowerCase().includes(editorSearch.toLowerCase()));

                return (
                    <div className="grid grid-cols-4 lg:grid-cols-5 gap-3 p-3 overflow-y-auto scrollbar-hide content-start">
                        {heroes.map(hero => {
                            let quickNote = null;
                            if (editorJungler) { quickNote = matchupData[editorJungler]?.[hero.name]?.quickNote; }
                            return (
                                <div key={hero.name} draggable onDragStart={(e) => handleDragStart(e, hero, dragSource)} onDragEnd={handleDragEnd}
                                    onClick={() => clickHandler ? clickHandler(hero) : null}
                                    className={`cursor-grab active:cursor-grabbing rounded-xl bg-slate-800/50 p-2 border border-white/5 hover:bg-slate-700 transition-all ${activeQuickRankTier && view === 'editor' && dragSource === 'unranked_pool' ? 'ring-2 ring-yellow-400 bg-yellow-400/10' : ''}`}>
                                    <HeroAvatar name={hero.name} role={hero.role} size="sm" showTooltip={true} quickNote={quickNote} onEditNote={view === 'editor' && editorJungler ? () => { setEditingQuickNoteHero(hero.name); setQuickNoteText(quickNote || ''); } : null} customImages={customImages} setTooltip={setTooltipState} />
                                    <div className="text-[10px] text-gray-400 text-center mt-1 truncate w-full">{hero.name}</div>
                                </div>
                            );
                        })}
                    </div>
                );
            };

            return (
                <div className="h-screen w-full flex flex-col bg-[#0f172a] text-gray-100">
                    <GlobalTooltip {...tooltipState} />

                    <nav className="h-16 bg-slate-900/80 backdrop-blur border-b border-white/10 flex items-center justify-between px-8 z-20 shrink-0">
                        <div className="flex items-center gap-4">
                            <div className="bg-cyan-500/10 p-2 rounded-lg border border-cyan-500/30"><Icons.Swords className="text-cyan-400" /></div>
                            <div><h1 className="text-xl font-bold text-white tracking-wider">JUNGLER<span className="text-cyan-400">OS</span></h1><div className="text-[10px] text-gray-500 tracking-[0.2em] uppercase">Tactical Counter Engine</div></div>
                        </div>
                        <div className="flex bg-slate-800 p-1 rounded-lg">
                            <button onClick={() => setView('draft')} className={`px-5 py-2 rounded-md text-xs font-bold uppercase tracking-wide transition-all flex items-center gap-2 ${view === 'draft' ? 'bg-cyan-600 text-white shadow-lg' : 'text-gray-400 hover:text-white'}`}><Icons.Target size={14} /> Draft Lab</button>
                            <button onClick={() => setView('editor')} className={`px-5 py-2 rounded-md text-xs font-bold uppercase tracking-wide transition-all flex items-center gap-2 ${view === 'editor' ? 'bg-purple-600 text-white shadow-lg' : 'text-gray-400 hover:text-white'}`}><Icons.Edit3 size={14} /> Database</button>
                            <button onClick={() => setView('assets')} className={`px-5 py-2 rounded-md text-xs font-bold uppercase tracking-wide transition-all flex items-center gap-2 ${view === 'assets' ? 'bg-orange-600 text-white shadow-lg' : 'text-gray-400 hover:text-white'}`}><Icons.Image size={14} /> Assets</button>
                            <button onClick={() => setView('data')} className={`px-5 py-2 rounded-md text-xs font-bold uppercase tracking-wide transition-all flex items-center gap-2 ${view === 'data' ? 'bg-emerald-600 text-white shadow-lg' : 'text-gray-400 hover:text-white'}`}><Icons.Database size={14} /> Data Hub</button>
                        </div>
                    </nav>

                    <main className="flex-1 flex overflow-hidden relative">
                        {view === 'draft' && (
                            <>
                                <div className={`w-[400px] bg-slate-900/50 border-r border-white/10 flex flex-col z-10 transition-colors duration-300 ${draggingSource === 'slot' ? 'bg-red-900/20 border-red-500/30' : ''}`} onDragOver={(e) => e.preventDefault()} onDrop={handleDropOnDraftPool}>
                                    <div className="p-5 border-b border-white/10">
                                        <h2 className="text-xs font-bold text-cyan-400 uppercase tracking-widest mb-4 flex items-center gap-2"><Icons.Search size={14}/> Hero Database</h2>
                                        <div className="flex flex-wrap gap-2 mb-4">
                                            {['All', ...Object.values(HERO_ROLES)].map(role => (
                                                <button key={role} onClick={() => setSelectedRoleFilter(role)} className={`text-[10px] px-3 py-1.5 rounded border font-semibold transition-all ${selectedRoleFilter === role ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'border-white/10 text-gray-500 hover:border-white/30'}`}>{role === 'All' ? 'ALL' : role.split(' ')[0]}</button>
                                            ))}
                                        </div>
                                        {draggingSource === 'slot' ? (<div className="w-full p-3 bg-red-500/20 border border-dashed border-red-400 rounded-lg flex items-center justify-center gap-3 animate-pulse"><Icons.Trash2 className="text-red-400" /><span className="text-xs text-red-300 font-bold uppercase">Drop here to remove</span></div>) : (<div className="w-full p-3 bg-slate-800 border border-dashed border-white/20 rounded-lg flex items-center gap-3 text-gray-500"><Icons.Info size={16} /><span className="text-xs font-medium">Drag Heroes to Slots</span></div>)}
                                    </div>
                                    <div className="flex-1 overflow-hidden hover:overflow-y-auto scrollbar-hide">{renderHeroPool('draft_pool', selectedRoleFilter)}</div>
                                </div>
                                <div className="flex-1 p-10 overflow-y-auto bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] scrollbar-hide">
                                    <div className="mb-10">
                                        <div className="flex items-center justify-between mb-6">
                                            <h2 className="text-lg font-bold text-red-400 flex items-center gap-2"><Icons.Skull size={18} /> ENEMY LINEUP</h2>
                                            <button onClick={() => setEnemySlots([null,null,null,null,null])} className="text-xs text-gray-500 hover:text-red-400 flex items-center gap-1 font-bold uppercase tracking-wide"><Icons.RotateCcw size={12} /> Clear All</button>
                                        </div>
                                        <div className="grid grid-cols-5 gap-6">
                                            {enemySlots.map((hero, idx) => (
                                                <div key={idx} draggable={hero !== null} onDragStart={(e) => handleDragStart(e, hero, 'slot', idx)} onDragEnd={handleDragEnd} onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDropOnSlot(e, idx)}
                                                    className={`aspect-[3/4] relative rounded-xl border-2 transition-all duration-300 flex flex-col items-center justify-center group cursor-pointer ${hero && hero.name !== 'Unpicked' ? 'bg-slate-800 border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.2)] hover:border-red-400' : 'bg-slate-900/40 border-white/5 border-dashed hover:border-white/20'}`}>
                                                    {hero ? (
                                                        <>
                                                            <HeroAvatar name={hero.name} role={hero.role} size="lg" showTooltip={true} className="scale-110" customImages={customImages} setTooltip={setTooltipState} />
                                                            <div className="mt-4 text-center"><div className="text-sm font-bold text-white">{hero.name}</div></div>
                                                        </>
                                                    ) : (<div className="text-white/10 flex flex-col items-center"><span className="text-4xl font-thin mb-2">+</span></div>)}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="glass-panel rounded-2xl p-8 relative overflow-hidden">
                                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500"></div>
                                        {currentDisplayHero ? (
                                            <div className="flex items-center gap-12 animate-scaleUp">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 text-cyan-400 mb-2"><Icons.Crown size={18} /><span className="text-xs font-bold uppercase tracking-widest">{viewedHero ? 'Alternative Option' : 'Recommended Priority'}</span></div>
                                                    <h1 className="text-5xl font-black text-white mb-4 tracking-tight">{currentDisplayHero.name}</h1>
                                                    <div className="grid grid-cols-2 gap-4 mb-6">
                                                        <div className="bg-slate-800/50 p-3 rounded border border-white/5"><div className="text-[10px] text-gray-400 uppercase">Score</div><div className="text-2xl font-mono font-bold text-cyan-400">{currentDisplayHero.score}</div></div>
                                                        <div className="bg-slate-800/50 p-3 rounded border border-white/5"><div className="text-[10px] text-gray-400 uppercase">Confidence</div><div className="text-2xl font-mono font-bold text-green-400">{Math.min(99, 50 + currentDisplayHero.matchupsKnown * 5)}%</div></div>
                                                    </div>
                                                    {viewedHero && <button onClick={() => setViewedHero(null)} className="text-xs text-cyan-400 hover:underline mb-2 block">&larr; Return to #1 Pick</button>}
                                                    <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                                        {enemySlots.filter(e => e && e.name !== 'Unpicked').map(enemy => {
                                                            const m = currentDisplayHero.data[enemy.name] || { tier: 'B' };
                                                            const qNote = m.quickNote;
                                                            return (
                                                                <div key={enemy.name} className="group relative flex items-center gap-2 bg-black/30 px-3 py-1 rounded border border-white/5">
                                                                    <span className="text-[10px] text-gray-400">vs {enemy.name}</span><span className={`text-[10px] font-bold px-1.5 rounded ${TIER_COLORS[m.tier]} text-white`}>{m.tier}</span>
                                                                    {qNote && <div className="absolute bottom-full mb-1 left-1/2 -translate-x-1/2 bg-black text-yellow-300 text-[9px] p-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-10 pointer-events-none border border-yellow-500/50">{qNote}</div>}
                                                                </div>
                                                            )
                                                        })}
                                                    </div>
                                                </div>
                                                <div className="shrink-0"><RadarChart heroes={sortedJunglers} currentHero={currentDisplayHero} onSelect={setViewedHero} /></div>
                                                <div className="relative"><div className="absolute inset-0 bg-cyan-500 blur-[60px] opacity-20 rounded-full"></div><HeroAvatar name={currentDisplayHero.name} role={HERO_ROLES.JUNGLE} size="xl" showTooltip={false} className="scale-125 border-4 border-cyan-500/30 rounded-2xl" customImages={customImages} setTooltip={setTooltipState} /></div>
                                            </div>
                                        ) : (<div className="flex flex-col items-center justify-center py-12 text-gray-500"><Icons.Target size={24} className="mb-4 opacity-50"/><div className="text-sm font-bold uppercase tracking-widest">Awaiting Enemy Data...</div></div>)}
                                    </div>
                                </div>
                            </>
                        )}

                        {view === 'editor' && (
                            <div className="flex-1 flex flex-col w-full animate-fadeIn">
                                <div className="h-16 bg-slate-900 border-b border-white/10 flex items-center px-6 gap-6 shrink-0">
                                    <div className="flex items-center gap-2 text-yellow-500"><Icons.Edit3 size={18} /><span className="font-bold uppercase text-sm">Editor Mode</span></div>
                                    <div className="h-6 w-px bg-white/10"></div>
                                    <div className="flex items-center gap-2">
                                        <select className="bg-slate-800 text-white border border-white/20 rounded-l px-4 py-2 focus:outline-none focus:border-cyan-500 text-sm font-medium min-w-[180px]" onChange={(e) => setEditorJungler(e.target.value)} value={editorJungler || ''}>
                                            <option value="" disabled>Select Jungler to Tune...</option>
                                            {junglerList.map(n => <option key={n} value={n}>{n}</option>)}
                                        </select>
                                        <button onClick={() => setIsAddingJungler(true)} className="bg-slate-800 hover:bg-slate-700 text-green-400 border border-white/20 border-l-0 rounded-r px-3 py-2" title="Add New Jungler"><Icons.Plus size={16} /></button>
                                    </div>
                                    {editorJungler && <button onClick={handleDeleteJungler} className="flex items-center gap-1 text-xs text-red-400 hover:text-red-300 border border-red-900/50 bg-red-900/20 px-3 py-1.5 rounded hover:bg-red-900/40 transition-colors"><Icons.Trash2 size={12} /> Remove Hero</button>}
                                </div>
                                {editorJungler ? (
                                    <div className="flex-1 flex overflow-hidden">
                                        <div className="flex-1 p-8 overflow-y-auto scrollbar-hide">
                                            <div className="space-y-4 pb-20">
                                                {TIERS.map(tier => {
                                                    const items = Object.entries(matchupData[editorJungler] || {}).filter(([_, d]) => d.tier === tier).map(([n, d]) => ({ name: n, ...d }));
                                                    return (
                                                        <div key={tier} className="flex bg-slate-900/50 rounded-lg border border-white/5 group hover:border-white/10 transition-all">
                                                            <div onClick={() => setActiveQuickRankTier(activeQuickRankTier === tier ? null : tier)} className={`w-24 flex flex-col items-center justify-center ${TIER_COLORS[tier]} cursor-pointer transition-all hover:brightness-110 ${activeQuickRankTier === tier ? 'ring-inset ring-4 ring-white' : ''}`}><span className="text-4xl font-black text-black/30">{tier}</span></div>
                                                            <div className="flex-1 p-4 flex flex-wrap gap-3 min-h-[120px] content-start" onDragOver={(e) => e.preventDefault()} onDrop={(e) => handleDropOnTier(e, tier)}>
                                                                {items.map(h => (
                                                                    <div key={h.name} className="relative group/item" draggable onDragStart={(e) => handleDragStart(e, {name: h.name}, 'tier_item')} onDragEnd={handleDragEnd} onDoubleClick={() => {setEditingCommentHero(h.name); setCommentText(h.comment || '');}}>
                                                                        <HeroAvatar name={h.name} role="Neutral" size="md" showTooltip={true} quickNote={h.quickNote} onEditNote={() => { setEditingQuickNoteHero(h.name); setQuickNoteText(h.quickNote || ''); }} customImages={customImages} setTooltip={setTooltipState} />
                                                                        {h.comment && <div className="absolute top-0 right-0 w-3 h-3 bg-cyan-400 rounded-full border-2 border-black z-20"></div>}
                                                                    </div>
                                                                ))}
                                                                {items.length === 0 && <div className="w-full h-full flex items-center justify-center text-white/5 font-bold text-2xl uppercase pointer-events-none">Drop Heroes Here</div>}
                                                            </div>
                                                        </div>
                                                    )
                                                })}
                                            </div>
                                        </div>
                                        <div className={`w-[350px] bg-slate-900 border-l border-white/10 flex flex-col transition-colors ${draggingSource === 'tier_item' ? 'bg-red-900/10 border-red-500/30' : ''}`} onDragOver={(e) => e.preventDefault()} onDrop={handleDropOnUnranked}>
                                            <div className="p-5 border-b border-white/10">
                                                <div className="flex items-center justify-between mb-4"><h3 className="text-sm font-bold text-white">Unranked Pool</h3><span className="text-[10px] text-gray-500 uppercase tracking-wider">{draggingSource === 'tier_item' ? <span className="text-red-400 animate-pulse font-bold">DROP TO UNRANK</span> : (activeQuickRankTier ? 'Quick Rank Mode' : 'Drag to Rank')}</span></div>
                                                <div className="relative mb-4"><Icons.Search className="absolute left-3 top-2.5 text-gray-500" size={16} /><input type="text" placeholder="Search..." className="w-full bg-slate-800 rounded-lg pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:ring-1 focus:ring-cyan-500 border border-white/5" value={editorSearch} onChange={(e) => setEditorSearch(e.target.value)} /></div>
                                                <div className="flex flex-wrap gap-2">{['All', ...Object.values(HERO_ROLES)].map(role => <button key={role} onClick={() => setEditorRoleFilter(role)} className={`text-[10px] px-2 py-1 rounded border ${editorRoleFilter === role ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'border-white/10 text-gray-500'}`}>{role === 'All' ? 'ALL' : role.split(' ')[0]}</button>)}</div>
                                            </div>
                                            <div className="flex-1 overflow-hidden hover:overflow-y-auto scrollbar-hide bg-slate-950/50 relative">
                                                 {draggingSource === 'tier_item' && <div className="absolute inset-0 z-50 bg-red-500/10 flex items-center justify-center border-2 border-dashed border-red-500/50 m-2 rounded-xl pointer-events-none"><span className="text-red-400 font-bold uppercase tracking-widest">Remove Rank</span></div>}
                                                {renderHeroPool('unranked_pool', editorRoleFilter, (hero) => activeQuickRankTier && updateMatchup(editorJungler, hero.name, activeQuickRankTier))}
                                            </div>
                                        </div>
                                    </div>
                                ) : (<div className="flex-1 flex flex-col items-center justify-center text-gray-600"><Icons.Edit3 size={48} className="mb-4 opacity-20" /><p className="font-bold uppercase tracking-widest">Select a Jungler to Begin Calibration</p></div>)}
                            </div>
                        )}

                        {view === 'assets' && (
                            <div className="flex-1 flex flex-col w-full animate-fadeIn overflow-hidden">
                                <div className="h-16 bg-slate-900 border-b border-white/10 flex items-center px-6 gap-6 shrink-0">
                                    <div className="flex items-center gap-2 text-orange-500"><Icons.Image size={18} /><span className="font-bold uppercase text-sm">Asset Manager</span></div>
                                    <div className="h-6 w-px bg-white/10"></div>
                                    <div className="relative w-64"><Icons.Search className="absolute left-3 top-2.5 text-gray-500" size={16} /><input type="text" placeholder="Search heroes to change icon..." className="w-full bg-slate-800 rounded-lg pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:ring-1 focus:ring-orange-500 border border-white/5" value={assetsSearch} onChange={(e) => setAssetsSearch(e.target.value)} /></div>
                                </div>
                                <div className="flex-1 p-8 overflow-y-auto scrollbar-hide">
                                    <div className="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
                                        {ALL_HEROES.filter(h => h.name !== 'Unpicked' && h.name.toLowerCase().includes(assetsSearch.toLowerCase())).map(hero => (
                                            <label key={hero.name} className="relative group cursor-pointer">
                                                <HeroAvatar name={hero.name} role={hero.role} size="lg" showTooltip={false} customImages={customImages} />
                                                <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded-xl">
                                                    <Icons.Upload className="text-white" size={24} />
                                                </div>
                                                <div className="text-center text-xs mt-2 text-gray-400">{hero.name}</div>
                                                <input type="file" className="hidden" accept="image/*" onChange={(e) => handleAssetUpload(e, hero.name)} />
                                            </label>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'data' && (
                            <div className="flex-1 flex flex-col items-center justify-center w-full animate-fadeIn bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                                <div className="glass-panel p-10 rounded-2xl w-full max-w-2xl border border-cyan-500/20 shadow-2xl">
                                    <div className="flex items-center gap-3 mb-8 border-b border-white/10 pb-6"><div className="p-3 bg-emerald-500/20 rounded-lg text-emerald-400"><Icons.Database size={32}/></div><div><h2 className="text-2xl font-bold text-white">Data Hub</h2><p className="text-gray-400 text-sm">Manage your local strategy database</p></div></div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-slate-800/50 p-6 rounded-xl border border-white/5 flex flex-col items-center text-center hover:bg-slate-800 transition-all">
                                            <div className="mb-4 text-cyan-400"><Icons.Download size={40}/></div>
                                            <h3 className="text-lg font-bold text-white mb-2">Backup Database</h3>
                                            <p className="text-xs text-gray-500 mb-6">Perfectly backup everything (Matchups, Roster, and Assets) to a local JSON file.</p>
                                            <button onClick={handleExport} className="w-full py-3 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white font-bold text-sm shadow-lg transition-all">Export Full Data</button>
                                        </div>
                                        <div className="bg-slate-800/50 p-6 rounded-xl border border-white/5 flex flex-col items-center text-center hover:bg-slate-800 transition-all">
                                            <div className="mb-4 text-purple-400"><Icons.Upload size={40}/></div>
                                            <h3 className="text-lg font-bold text-white mb-2">Restore Database</h3>
                                            <p className="text-xs text-gray-500 mb-6">Load a previously saved JSON file. Warning: Overwrites current data.</p>
                                            <label className="w-full py-3 rounded-lg bg-purple-600 hover:bg-purple-500 text-white font-bold text-sm shadow-lg transition-all cursor-pointer flex items-center justify-center"><span>Select File</span><input type="file" accept=".json" className="hidden" onChange={handleImport} ref={fileInputRef} /></label>
                                        </div>
                                    </div>
                                    <div className="mt-8 pt-6 border-t border-white/10 flex justify-between items-center text-xs text-gray-500 w-full">
                                        <div className="flex gap-4">
                                            <span>Matchups: <span className="text-white">{stats.matchupCount}</span></span>
                                            <span>Roster: <span className="text-white">{stats.junglerCount}</span></span>
                                            <span>Assets: <span className="text-white">{stats.imageCount}</span></span>
                                        </div>
                                        <button onClick={() => {if(confirm("Are you sure? This will wipe all data.")){localStorage.clear(); window.location.reload();}}} className="text-red-400 hover:text-red-300 underline">Reset to Factory Defaults</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    {/* TACTICAL NOTE MODAL (Long Comment) */}
                    {editingCommentHero && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fadeIn">
                            <div className="bg-slate-900 border border-white/10 p-6 rounded-2xl w-96 shadow-2xl">
                                <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2"><Icons.MessageSquare className="text-cyan-400" /> <span>vs <span className="text-cyan-400">{editingCommentHero}</span></span></h3>
                                <textarea className="w-full h-32 bg-slate-800 border border-white/10 rounded p-3 text-sm text-white focus:outline-none focus:border-cyan-500 mb-4 resize-none" placeholder="Enter deep tactical analysis..." value={commentText} onChange={(e) => setCommentText(e.target.value)} />
                                <div className="flex justify-end gap-2"><button onClick={() => setEditingCommentHero(null)} className="px-4 py-2 rounded text-sm text-gray-400 hover:text-white">Cancel</button><button onClick={() => {const d = {...matchupData}; if(!d[editorJungler]) d[editorJungler]={}; d[editorJungler][editingCommentHero] = { ...(d[editorJungler][editingCommentHero] || {tier:'B'}), comment: commentText }; saveToStorage(d); setEditingCommentHero(null); setCommentText('');}} className="px-4 py-2 rounded bg-cyan-600 hover:bg-cyan-500 text-white text-sm font-bold shadow-lg">Save Tactics</button></div>
                            </div>
                        </div>
                    )}

                    {/* QUICK TIP MODAL */}
                    {editingQuickNoteHero && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fadeIn">
                            <div className="bg-slate-900 border border-yellow-500/30 p-4 rounded-2xl w-80 shadow-2xl">
                                <h3 className="text-sm font-bold text-yellow-400 mb-3 flex items-center gap-2"><Icons.Pencil size={14} /> Quick Tip: {editingQuickNoteHero}</h3>
                                <input type="text" maxLength="30" className="w-full bg-slate-800 border border-white/10 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-yellow-500 mb-4" placeholder="Ex: Ult cancels S2 (Max 30 chars)" value={quickNoteText} onChange={(e) => setQuickNoteText(e.target.value)} />
                                <div className="flex justify-end gap-2"><button onClick={() => setEditingQuickNoteHero(null)} className="px-3 py-1 rounded text-xs text-gray-400 hover:text-white">Cancel</button><button onClick={() => {const d = {...matchupData}; if(!d[editorJungler]) d[editorJungler]={}; d[editorJungler][editingQuickNoteHero] = { ...(d[editorJungler][editingQuickNoteHero] || {tier:'B'}), quickNote: quickNoteText }; saveToStorage(d); setEditingQuickNoteHero(null); setQuickNoteText('');}} className="px-3 py-1 rounded bg-yellow-600 hover:bg-yellow-500 text-black text-xs font-bold shadow-lg">Save Tip</button></div>
                            </div>
                        </div>
                    )}

                    {/* ADD JUNGLER MODAL */}
                    {isAddingJungler && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fadeIn">
                            <div className="bg-slate-900 border border-green-500/30 p-4 rounded-2xl w-80 shadow-2xl">
                                <h3 className="text-sm font-bold text-green-400 mb-3 flex items-center gap-2"><Icons.Plus size={14} /> Add Custom Jungler</h3>
                                <input type="text" className="w-full bg-slate-800 border border-white/10 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-green-500 mb-4" placeholder="Hero Name (e.g. Gusion)" value={newJunglerName} onChange={(e) => setNewJunglerName(e.target.value)} />
                                <div className="flex justify-end gap-2">
                                    <button onClick={() => setIsAddingJungler(false)} className="px-3 py-1 rounded text-xs text-gray-400 hover:text-white">Cancel</button>
                                    <button onClick={handleAddJungler} className="px-3 py-1 rounded bg-green-600 hover:bg-green-500 text-white text-xs font-bold shadow-lg">Add Hero</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
